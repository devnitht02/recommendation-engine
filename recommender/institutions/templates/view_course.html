{% extends "base.html" %}
{% load static %}

{% block css_cdn %}
    <link rel="stylesheet" href="{% static 'src/view_course.css' %}">
{% endblock css_cdn %}

{% block content %}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            $(document).on('click', '.bookmark-btn', function (e) {
                e.preventDefault();
                e.stopPropagation();

                const button = $(this);
                const icon = button.find('i');
                const courseId = button.data('course-id');

                $.ajax({
                    url: "{% url 'institutions:toggle_favourite' %}",
                    type: "POST",
                    headers: {'X-Requested-With': 'XMLHttpRequest'},
                    data: {
                        course_id: courseId,
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                    success: function (response) {
                        if (response.status === 'added') {
                            icon.removeClass('fa-regular').addClass('fa-solid');
                        } else if (response.status === 'removed') {
                            icon.removeClass('fa-solid').addClass('fa-regular');
                        }
                    },
                    error: function (xhr) {
                        alert(xhr.status === 403 ? "Please log in to bookmark." : "Bookmark error. Try again.");
                    }
                });
            });
        });
    </script>

    <div class="bg-white pt-36 pb-20 px-4 flex justify-center">
        <div class="w-full max-w-xl min-h-[600px] bg-white border border-purple-300 shadow-lg rounded-2xl p-8">

            <!-- Title -->
            <h1 class="text-3xl font-extrabold text-center text-gray-900 mb-6">
                {{ course.course_name }}
            </h1>

            <!-- Bookmark Button -->
            <div class="text-end mb-4">
                <button type="button"
                        class="bookmark-btn text-purple-700 hover:text-yellow-400"
                        data-course-id="{{ course.id }}"
                        title="Bookmark this course">
                    <i class="{% if course.id in favourite_course %}fa-solid{% else %}fa-regular{% endif %} fa-bookmark fa-lg"
                       style="color: #5521b5; position: relative; left: 30rem"></i>
                </button>
            </div>

            <!-- Details -->
            <div class="space-y-5 text-lg text-gray-800 mb-8">
                <div class="text-xl font-semibold text-gray-700 mb-4">
                    <div class="flex items-center mb-1">
                        <i class="fa-solid fa-book-open fa-lg text-purple-600 mr-3"></i>
                        <span>Description:</span>
                    </div>
                    <p class="text-gray-800 font-normal ml-8">{{ course.course_description }}</p>
                </div>


                <p class="flex items-center text-xl font-semibold text-gray-700">
                    <i class="fa-solid fa-user-graduate fa-lg text-purple-600 mr-3"></i>
                    Degree:
                    <span class="ml-2 font-normal">{{ course.degree.degree_description|default:"Not Available" }}</span>
                </p>

                <p class="flex items-center text-xl font-semibold text-gray-700">
                    <i class="fa-solid fa-graduation-cap fa-lg text-purple-600 mr-3"></i>
                    Stream:
                    <span class="ml-2 font-normal">{{ course.stream.stream_name|default:"Not Available" }}</span>
                </p>

                <p class="flex items-center text-xl font-semibold text-gray-700">
                    <i class="fa-solid fa-clock fa-lg text-purple-600 mr-3"></i>
                    Duration:
                    <span class="ml-2 font-normal">{{ course.duration_years }} Years</span>
                </p>

                <p class="flex items-center text-xl font-semibold text-gray-700">
                    <i class="fa-solid fa-credit-card fa-lg text-purple-600 mr-3"></i>
                    Price:
                    <span class="ml-2 font-normal">INR(₹) {{ course.degree_price }}</span>
                </p>
            </div>

            <!-- Back Button -->
            <div class="mt-10 text-center">
                <a href="{% url 'institutions:courses' %}"
                   class="bg-purple-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-purple-700 transition duration-300">
                    ← Back to Courses
                </a>
            </div>
        </div>
    </div>

    {% include 'footer.html' %}
{% endblock content %}
